<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="style.css">
<title>Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±ÙŠÙ‚</title>
</head>
<body class="join">
<nav class="site-nav">
  <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="join.html">Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±ÙŠÙ‚</a>
  <a href="board.html">Ù„ÙˆØ­Ø© Ø§Ù„Ø³Ø¨Ø§Ù‚</a>
</nav>
<div class="card">
  <h2 id="title">ğŸ“± Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±ÙŠÙ‚</h2>
  <div id="joinBox">
    <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚">
    <button onclick="join()">Ø¯Ø®ÙˆÙ„</button>
  </div>
  <div id="gameBox" style="display:none;">
    <div id="dice" style="font-size:80px; display:none;">ğŸ²</div>
    <h1 id="msg">â³ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h1>
    <h2 id="timer"></h2>
    <button id="answerBtn" onclick="answered()" style="display:none; background:#4caf50;">Ø¬Ø§ÙˆØ¨</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let countdown = null;
const diceSound = new Audio("https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3");
const failSound = new Audio("https://assets.mixkit.co/active_storage/sfx/2516/2516-preview.mp3");

function join() {
  const n = document.getElementById("name").value;
  if (!n) return;
  socket.emit("join", { name: n });
  document.getElementById("joinBox").style.display = "none";
  document.getElementById("gameBox").style.display = "block";
}

socket.on("receiveDice", (time) => {
  diceSound.play();
  document.getElementById("dice").style.display = "block";
  document.getElementById("msg").innerText = "ğŸ”” Ø¯ÙˆØ±ÙƒÙ…!";
  document.getElementById("answerBtn").style.display = "block";
  let t = time;
  document.getElementById("timer").innerText = "â± " + t;
  clearInterval(countdown);
  countdown = setInterval(() => {
    t--; document.getElementById("timer").innerText = "â± " + t;
    if (t <= 0) clearInterval(countdown);
  }, 1000);
});

socket.on("noAnswer", () => { failSound.play(); resetUI(); });

socket.on("state", (s) => {
  document.getElementById("title").innerText = s.contestName;
  if (!s.current || s.current.id !== socket.id) resetUI();
});

function resetUI() {
  document.getElementById("answerBtn").style.display = "none";
  document.getElementById("dice").style.display = "none";
  document.getElementById("msg").innerText = "â³ Ø§Ù†ØªØ¸Ø±ÙˆØ§ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©";
  clearInterval(countdown);
}

function answered() {
  document.getElementById("msg").innerText = "â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø©";
  document.getElementById("answerBtn").style.display = "none";
  clearInterval(countdown);
}
</script>
</body>
</html>
